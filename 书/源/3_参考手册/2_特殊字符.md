# 特殊字符

这些字符会被词法分析 (token) 特殊处理:

| 数值 | 字符 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| 0x0a | `\n` (换行) | 分隔不同的文本行 | |
| 0x20 | ` ` (空格) | 行首缩进, 以及代码中的空白 (解决歧义: 手动分词) | |
| 0x22 | `"` | 双引号: 用于字符串 | |
| 0x23 | `#` | 注释 | |
| 0x28 | `(` | 小括号: 用于多种语法 | |
| 0x29 | `)` | 小括号: 用于多种语法 | |
| 0x2c | `,` | 逗号: 用于多种语法 | |
| 0x3a | `:` | 冒号: 用于代码块, 字典 | |
| 0x3d | `=` | 等号: 用于赋值语句 | |
| 0x5b | `[` | 中括号: 用于数组及下标访问 | |
| 0x5c | `\` | 反斜杠: 字符串转义 | |
| 0x5d | `]` | 中括号: 用于数组及下标访问 | |
| 0x60 | \` | 反引号: 用于解决歧义 (禁止分词) | |
| 0x7b | `{` | 大括号: 用于字典 | |
| 0x7d | `}` | 大括号: 用于字典 | |
| 0x3001 | `、` | 顿号: 用于分隔多个项目 | |
| 0x3002 | `。` | 句号: 用于结束语句 | |
| 0x30 ~ 0x39 0x2e 0x5f | `0` ~ `9` `.` `_` | 用于数字 | |

源代码中禁止出现的 Unicode 字符:

TODO


## 标识符

本节详细说明哪些字符可以作为歧语言的标识符。

歧语言的标识符使用 "黑名单" 策略, 除了特别禁止使用的字符之外,
所有的 Unicode 字符都可以作为标识符的一部分。

单个标识符的长度不得超过 255 个 Unicode 字符。

### 绝对禁用的字符

(编译错误)

以下字符 **绝对** 不能作为标识符的一部分:

| 数值 | 字符 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| 0x0a | `\n` | 换行 | |
| 0x20 | ` ` | 空格 | |
| 0x5c | `\` | 反斜杠 | |
| 0x60 | \` | 反引号 | |
| | 控制字符 | 所有 Unicode 控制字符 | (1) |
| | 空白字符 | 所有 Unicode 空白字符 | (2) |
| | | 其余不能在源代码中使用的字符 | 详见上一节 |

注:

+ (1) 控制字符使用 (rust) [`char.is_control()`](https://doc.rust-lang.org/std/primitive.char.html#method.is_control) 判断。

+ (2) 空白字符使用 (rust) [`char.is_whitespace()`](https://doc.rust-lang.org/std/primitive.char.html#method.is_whitespace) 判断。

以下字符 **绝对** 不能作为标识符的第一个字符:

| 数值 | 字符 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| 0x30 ~ 0x39 | `0` ~ `9` | 用于数字的开始 | |

### 强烈建议不使用的字符

(编译警告)

强烈建议不要使用以下字符作为标识符的一部分:

+ 被词法分析特殊处理的字符:

  详见本章开头。

+ 与 `关键词` 冲突:

  详见 [关键词](./4_关键词.md)。

如果非要作为标识符, 需要用 \` (反引号) 包裹起来, 比如:

```
定义`定义`
```

### 保证可以作为标识符使用的字符

以下字符 **保证** 可以作为标识符的一部分, 即使在后续歧语言版本 (向后兼容)。

| 数值 | 字符 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| 0x30 ~ 0x39 | `0` ~ `9` | 数字 | 不能用作标识符的第一个字符 |
| 0x41 ~ 0x5a 0x61 ~ 0x7a | `A` ~ `Z` `a` ~ `z` | 英文字母 | |
| 0x5f | `_` | 下划线 | |
| | 汉字 | Unicode 中收录的所有汉字 | 不能与 `关键词` 冲突 |

对于不做保证的字符, 可以作为标识符使用, 但是当歧语言版本升级之后,
可能不能再用作标识符, 从而导致源代码编译错误 (不保证兼容性)。

### 标识符的编译

当标识符无法直接编译为底层语言 (歧语言的编译目标, 比如 月兔代码)
的标识符的时候, 需要对标识符进行转换处理。
本节说明具体的转换规则。

+ 标识符含有底层语言不支持的字符:

  对每个不支持的字符, 取得其 Unicode 编码 (16 进制, 开头没有 `0`),
  替换为如下格式:

  `u{编码}_`

  比如对于字符 `。` (句号), 替换之后为 `u3002_`。

+ 标识符太长:

  如果标识符 (经过上一步处理之后) 的长度超过了底层语言允许的最大值,
  对标识符进行截断处理, 然后添加序号 (10 进制, 从 `1` 开始)
  用于区分不同的标识符:

  `__{序号}`

  比如有 2 个超长标识符: `超长标识符第一个`, `超长标识符第二个`

  则转换之后为: `超长__1`, `超长__2`

  即使只有一个超长的标识符, 也要添加序号。
